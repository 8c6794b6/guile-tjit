#! /bin/sh
# Usage: check-guile [-i GUILE-INTERPRETER] [GUILE-TEST-ARGS]
# If `-i GUILE-INTERPRETER' is omitted, use libguile/guile.
# See test-suite/guile-test for documentation on GUILE-TEST-ARGS.
#
# Example invocations:
# ./check-guile
# ./check-guile numbers.test
# ./check-guile -i /usr/local/bin/guile
# ./check-guile -i /usr/local/bin/guile numbers.test

# this script runs in the top-level build-dir.
srcdir=@srcdir@
TEST_SUITE_DIR=$srcdir/test-suite

if [ x"$1" = x-i ] ; then
    guile=$2
    shift
    shift
    GUILE_LOAD_PATH=$TEST_SUITE_DIR
else
    guile=libguile/guile
    GUILE_LOAD_PATH=$srcdir:$TEST_SUITE_DIR
    LTDL_LIBRARY_PATH=`pwd`/srfi:${LTDL_LIBRARY_PATH}
fi
export GUILE_LOAD_PATH
export LTDL_LIBRARY_PATH

if [ -f "$guile" -a -x "$guile" ] ; then
    echo Testing $guile ... "$@"
    echo with GUILE_LOAD_PATH=$GUILE_LOAD_PATH
    echo with LTDL_LIBRARY_PATH=$LTDL_LIBRARY_PATH
else
    echo ERROR: Cannot execute $guile
    exit 1
fi

# documentation searching ignores GUILE_LOAD_PATH.
if [ ! -f guile-procedures.txt ] ; then
   ln -s libguile/guile-procedures.txt .
fi

exec "$guile" -e main -s "$TEST_SUITE_DIR/guile-test" --test-suite "$TEST_SUITE_DIR/tests" --log-file check-guile.log "$@"

# check-guile ends here
