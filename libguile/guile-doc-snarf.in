#!/bin/sh
# Extract the initialization actions for builtin things.

filename=$1; shift

# we need to be sure that the .x file exists
# since the .c/.cc file may include it
# (the old guile-snarf did not have this problem
#  because the makefile redirects output to the .x file
#  which creates the file before the inclusion occurs)
# --12/12/99 gjb
dot_x=${filename%.*}.x
touch --date=01/01/70 $dot_x

temp="/tmp/snarf.$$"
trap "rm -f $temp" 0 1 2 15

## Let the user override the preprocessor autoconf found.
test -n "${CPP+set}" || CPP="@CPP@"

## We must use a temporary file here, instead of a pipe, because we
## need to know if CPP exits with a non-zero status.
${CPP} -DSCM_MAGIC_SNARFER "$@" > ${temp} || exit $?
< ${temp} awk -f `dirname $0`/guile-doc-snarf.awk $filename
