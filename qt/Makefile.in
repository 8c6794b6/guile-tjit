# Makefile for libqt
#
# Copyright (C) 1996, Free Software Foundation, Inc.
# 
# This file is part of GNU GUILE.
# 
# GNU GUILE is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2, or (at your option)
# any later version.
# 
# GNU GUILE is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with GNU GUILE; see the file COPYING.  If not, write to
# the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.

SHELL = /bin/sh
srcdir = @srcdir@
VPATH = @srcdir@

prefix = @prefix@
exec_prefix = $(prefix)
libdir = $(exec_prefix)/lib
includedir = $(prefix)/include/threads
infodir = $(prefix)/info

CC = @CC@
INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@

DEFS = @DEFS@
LIBS = @LIBS@

AR_FLAGS = rc
RANLIB = @RANLIB@

CFLAGS = -g
XCFLAGS = $(CFLAGS) -I. 
LDFLAGS = -g

#### End of system configuration section. ####

distfiles = .cvsignore CHANGES ChangeLog INSTALL Makefile.base \
	Makefile.in README README.MISC README.PORT b.h config configure \
	configure.in copyright.h meas.c qt.c qt.h.in stp.c stp.h
plugin_distfiles = OPT greet
md_distfiles = \
	default.Makefile null.README null.c \
	axp.1.Makefile axp.2.Makefile axp.Makefile axp.README axp.c \
		axp.h axp.s axp_b.s \
	hppa-cnx.Makefile hppa.Makefile hppa.h hppa.s hppa_b.s \
	i386.README i386.h i386.s i386_b.s \
	ksr1.Makefile ksr1.h ksr1.s ksr1_b.s \
	m88k.Makefile m88k.c m88k.h m88k.s m88k_b.s \
	mips-irix5.s mips.h mips.s mips_b.s \
	solaris.README sparc.h sparc.s sparc_b.s _sparc.s _sparc_b.s \
	vax.h vax.s vax_b.s
time_distfiles = README.time assim cswap go init prim raw

all_objs= qt.o qtmds.o qtmdc.o

all: @target_all@

libqt.a: $(all_objs)
	$(AR) $(AR_FLAGS) libqt.a $(all_objs)
	$(RANLIB) libqt.a

# The `dist' target in the top-level Makefile uses this `dist-dir'
# target to select the appropriate files for distribution from the
# directory containing this Makefile.
.PHONY: dist-dir
dist-dir:
	mkdir ${DISTDIR}
	for f in ${distfiles}; do \
	  ln ${srcdir}/$$f ${DISTDIR}; \
	done
	mkdir ${DISTDIR}/PLUGIN
	for f in ${plugin_distfiles}; do \
	  ln ${srcdir}/PLUGIN/$$f ${DISTDIR}/PLUGIN; \
	done
	mkdir ${DISTDIR}/md
	for f in ${md_distfiles}; do \
	  ln ${srcdir}/md/$$f ${DISTDIR}/md; \
	done
	mkdir ${DISTDIR}/time
	for f in ${time_distfiles}; do \
	  ln ${srcdir}/time/$$f ${DISTDIR}/time; \
	done


install: @target_install@
install_qt: all
	test -d $(prefix) || mkdir $(prefix)
	test -d $(libdir) || mkdir $(libdir)
	$(INSTALL) libqt.a $(libdir)/libqt.a
	$(RANLIB) $(libdir)/libqt.a
	$(INSTALL) $(srcdir)/qt.h $(includedir); 

uninstall: @target_uninstall@
uninstall_qt:
	-rm -f $(libdir)/libqt.a
	-rm -f $(includedir)/qt.h

info:

clean:
	-rm -f guile
	-rm -f $(all_objs)

distclean: clean
	-rm -f config.cache
	-rm -f config.log
	-rm -f config.status

realclean: distclean

###

qt.o: $(srcdir)/qt.c @qtmd_h@ qt.h $(srcdir)/copyright.h
	$(CC) -o qt.o -c $(CPPFLAGS) $(DEFS) $(XCFLAGS) -I$(srcdir) $(srcdir)/qt.c

qtmds.o: @qtmds_s@ 
	$(CC) -o qtmds.o -c $(CPPFLAGS) $(DEFS) $(XCFLAGS) -I$(srcdir) @qtmds_s@

qtmdc.o: @qtmdc_c@ @qtmd_h@
	$(CC) -o qtmdc.o -c $(CPPFLAGS) $(DEFS) $(XCFLAGS) -I$(srcdir) @qtmdc_c@

